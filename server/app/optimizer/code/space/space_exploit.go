package space

func (s *Space) Exploit(floorPrice, price float64) (float64, error) {
	s.wcMutex.Lock()
	winningCurve := make([]float64, len(s.winningCurve))
	copy(winningCurve, s.winningCurve)
	s.wcMutex.Unlock()

	sum := 0.0
	for i := 0; i < len(s.Levels); i++ {
		r, err := s.Levels[i].exploit(floorPrice, price, winningCurve)
		if err != nil {
			return price, err
		}
		sum += r
	}
	return sum / float64(len(s.Levels)), nil
}
